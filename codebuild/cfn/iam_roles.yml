# Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License"). You may not use
# this file except in compliance with the License. A copy of the License is
# located at
#
# http://aws.amazon.com/apache2.0/
#
# or in the "license" file accompanying this file. This file is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
# implied. See the License for the specific language governing permissions and
# limitations under the License.
{
    "Resources": {
        "CESDKCodeBuildRole": {
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "sts:AssumeRole"
                            ],
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "codebuild.amazonaws.com"
                                ]
                            }
                        }
                    ]
                }
            },
            "Type": "AWS::IAM::Role"
        },
        "CESDKCodebuildPolicy": {
            "DependsOn": "CESDKCodeBuildRole",
            "Properties": {
                "PolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "logs:CreateLogGroup",
                                "logs:CreateLogStream",
                                "logs:PutLogEvents"
                            ],
                            "Effect": "Allow",
                            "Resource": [
                                "arn:aws:logs:us-west-2:636124823696:log-group:/aws/codebuild/csdk-trusty-gcc4x-x64",
                                "arn:aws:logs:us-west-2:636124823696:log-group:/aws/codebuild/csdk-trusty-gcc4x-x64:*"
                            ]
                        },
                        {
                            "Action": [
                                "s3:PutObject",
                                "s3:GetObject",
                                "s3:GetObjectVersion",
                                "s3:GetBucketAcl",
                                "s3:GetBucketLocation"
                            ],
                            "Effect": "Allow",
                            "Resource": [
                                "arn:aws:s3:::codepipeline-us-west-2-*"
                            ]
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "PolicyName": "ESDKC-TestResources",
                "Roles": [
                    {
                        "Ref": "CESDKCodeBuildRole"
                    }
                ]
            },
            "Type": "AWS::IAM::Policy"
        }
    }
}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AWS Encryption SDK for C: Materials providers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AWS Encryption SDK for C
   &#160;<span id="projectnumber">v0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Materials providers</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae0406ce3f5385519f18ad06da19f86a8"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cmm__kr__highlevel.html#gae0406ce3f5385519f18ad06da19f86a8">aws_cryptosdk_default_cmm_new</a> (struct aws_allocator *alloc, struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *kr)</td></tr>
<tr class="separator:gae0406ce3f5385519f18ad06da19f86a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae54bf69cb202b2c629acb41aca4b07ad"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cmm__kr__highlevel.html#gae54bf69cb202b2c629acb41aca4b07ad">aws_cryptosdk_default_cmm_set_alg_id</a> (struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a> *cmm, enum <a class="el" href="group__session.html#ga3a102b234535436099f0821e677686f9">aws_cryptosdk_alg_id</a> alg_id)</td></tr>
<tr class="separator:gae54bf69cb202b2c629acb41aca4b07ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacb9da4c10fbdbd95308eea0992c1d204"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cmm__kr__highlevel.html#gacb9da4c10fbdbd95308eea0992c1d204">aws_cryptosdk_cmm_release</a> (struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a> *cmm)</td></tr>
<tr class="separator:gacb9da4c10fbdbd95308eea0992c1d204"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0432853b9687ae2c10fb6827ac0e68d2"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cmm__kr__highlevel.html#ga0432853b9687ae2c10fb6827ac0e68d2">aws_cryptosdk_cmm_retain</a> (struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a> *cmm)</td></tr>
<tr class="separator:ga0432853b9687ae2c10fb6827ac0e68d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga83ec916071e16d9a4427cecc57130bc5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cmm__kr__highlevel.html#ga83ec916071e16d9a4427cecc57130bc5">aws_cryptosdk_keyring_release</a> (struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *keyring)</td></tr>
<tr class="separator:ga83ec916071e16d9a4427cecc57130bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabf5e35d059e627c4d7be66ad6322ae1f"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cmm__kr__highlevel.html#gabf5e35d059e627c4d7be66ad6322ae1f">aws_cryptosdk_keyring_retain</a> (struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *keyring)</td></tr>
<tr class="separator:gabf5e35d059e627c4d7be66ad6322ae1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa8483174b8c6a797b60606a34bc6cfe3"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cmm__kr__highlevel.html#gaa8483174b8c6a797b60606a34bc6cfe3">aws_cryptosdk_multi_keyring_new</a> (struct aws_allocator *alloc, struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *generator)</td></tr>
<tr class="separator:gaa8483174b8c6a797b60606a34bc6cfe3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga20123ef3f4ea3f82240c0123ad6b04f0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cmm__kr__highlevel.html#ga20123ef3f4ea3f82240c0123ad6b04f0">aws_cryptosdk_multi_keyring_add_child</a> (struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *multi, struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *child)</td></tr>
<tr class="separator:ga20123ef3f4ea3f82240c0123ad6b04f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The behavior of the encryption SDK is largely defined by two types of materials providers - the Crypto Materials Managers (CMMs) and Keyrings. In order to perform an encryption or decryption operation, the <a class="el" href="group__session.html">Session APIs</a> must be given a CMM, which will typically be configured to delegate to one or more keyrings to perform the key wrapping or unwrapping operation.</p>
<p>Broadly speaking, you can think of a keyring as defining the underlying keys used to encrypt and decrypt (and therefore, who has access to the final message), while CMMs can perform higher-level manipulations on the overall encrypt/decrypt operation (such as caching the results of invoking the keyring).</p>
<p>CMM and keyring objects are reference counted to make it easier to construct higher-level CMMs or keyrings out of other primitives; in general, functions in the encryption SDK which take a CMM or keyring as an argument will appropriately increment the reference count (and decrement it when they no longer have a reference). When this reference count reaches zero, the CMM or keyring will be destroyed.</p>
<p>All CMMs and keyrings provided as built-ins are thread-safe with respect to the API they expose to the session; however, any configuration APIs that are specific to the type of CMM or keyring in question may not be thread safe (that is, you can't safely change the configuration while using the CMM or keyring on another thread's session object). </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gacb9da4c10fbdbd95308eea0992c1d204"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacb9da4c10fbdbd95308eea0992c1d204">&#9670;&nbsp;</a></span>aws_cryptosdk_cmm_release()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void aws_cryptosdk_cmm_release </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a> *&#160;</td>
          <td class="paramname"><em>cmm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decrements the reference count on the CMM. If the new reference count is zero, the CMM is destroyed. </p>

<p class="definition">Definition at line <a class="el" href="materials_8h_source.html#l00341">341</a> of file <a class="el" href="materials_8h_source.html">materials.h</a>.</p>

</div>
</div>
<a id="ga0432853b9687ae2c10fb6827ac0e68d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0432853b9687ae2c10fb6827ac0e68d2">&#9670;&nbsp;</a></span>aws_cryptosdk_cmm_retain()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a>* aws_cryptosdk_cmm_retain </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a> *&#160;</td>
          <td class="paramname"><em>cmm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Increments the reference count on the CMM. </p>

<p class="definition">Definition at line <a class="el" href="materials_8h_source.html#l00351">351</a> of file <a class="el" href="materials_8h_source.html">materials.h</a>.</p>

</div>
</div>
<a id="gae0406ce3f5385519f18ad06da19f86a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae0406ce3f5385519f18ad06da19f86a8">&#9670;&nbsp;</a></span>aws_cryptosdk_default_cmm_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a>* aws_cryptosdk_default_cmm_new </td>
          <td>(</td>
          <td class="paramtype">struct aws_allocator *&#160;</td>
          <td class="paramname"><em>alloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td>
          <td class="paramname"><em>kr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Instantiate the default (non-caching) implementation of the Crypto Materials Manager (CMM). A Keyring must have already been instantiated and a pointer to it passed in. This CMM implements all of the CMM virtual functions.</p>
<p>On each call to Generate Encryption Materials, it makes a call to the keyring's On Encrypt function to generate and encrypt a data key. If an algorithm suite that does not include signing is used, this is the only thing that the Generate Encryption Materials does. If an algorithm suite that does include signing is used, then the call additionally begins the calculation of the trailing signature, which will be completed by the session.</p>
<p>On each call to Decrypt Materials, it passes the full list of EDKs to the keyring and asks it to find one to decrypt, via the keyring's On Decrypt function. If an algorithm suite that does not include signing is used, this is the only thing that the Decrypt Materials call does. If an algorithm suite that does include signing is used, then the call additionally begins the verification of the trailing signature, which will be completed by the session.</p>
<p>If a CMM that delegates to the default CMM selects an algorithm suite, that algorithm suite will be used. Otherwise, the default CMM will select a default algorithm suite. This is initially ALG_AES256_GCM_IV12_TAG16_HKDF_SHA384_ECDSA_P384, but can be overridden using aws_cryptosdk_default_cmm_set_alg_id.</p>
<p>On success allocates a CMM and returns a pointer to it. Be sure to call aws_cryptosdk_cmm_release when you are done using the pointer so that the memory is properly deallocated.</p>
<p>On failure returns NULL and sets an internal AWS error code. </p>

</div>
</div>
<a id="gae54bf69cb202b2c629acb41aca4b07ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae54bf69cb202b2c629acb41aca4b07ad">&#9670;&nbsp;</a></span>aws_cryptosdk_default_cmm_set_alg_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int aws_cryptosdk_default_cmm_set_alg_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__cmm.html">aws_cryptosdk_cmm</a> *&#160;</td>
          <td class="paramname"><em>cmm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__session.html#ga3a102b234535436099f0821e677686f9">aws_cryptosdk_alg_id</a>&#160;</td>
          <td class="paramname"><em>alg_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Selects the algorithm suite ID to use for encryption. If not called, a reasonable default will be selected. Raises AWS_CRYPTOSDK_ERR_UNSUPPORTED_FORMAT if the algorithm suite ID is unknown. </p>

</div>
</div>
<a id="ga83ec916071e16d9a4427cecc57130bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga83ec916071e16d9a4427cecc57130bc5">&#9670;&nbsp;</a></span>aws_cryptosdk_keyring_release()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void aws_cryptosdk_keyring_release </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td>
          <td class="paramname"><em>keyring</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decrements the reference count on the keyring; if the new reference count is zero, the keyring is destroyed. </p>

<p class="definition">Definition at line <a class="el" href="materials_8h_source.html#l00456">456</a> of file <a class="el" href="materials_8h_source.html">materials.h</a>.</p>

</div>
</div>
<a id="gabf5e35d059e627c4d7be66ad6322ae1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabf5e35d059e627c4d7be66ad6322ae1f">&#9670;&nbsp;</a></span>aws_cryptosdk_keyring_retain()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a>* aws_cryptosdk_keyring_retain </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td>
          <td class="paramname"><em>keyring</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Increments the reference count on the keyring. </p>

<p class="definition">Definition at line <a class="el" href="materials_8h_source.html#l00466">466</a> of file <a class="el" href="materials_8h_source.html">materials.h</a>.</p>

</div>
</div>
<a id="ga20123ef3f4ea3f82240c0123ad6b04f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga20123ef3f4ea3f82240c0123ad6b04f0">&#9670;&nbsp;</a></span>aws_cryptosdk_multi_keyring_add_child()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int aws_cryptosdk_multi_keyring_add_child </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td>
          <td class="paramname"><em>multi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td>
          <td class="paramname"><em>child</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds a new child keyring to this multi-keyring. Child keyrings are only used to encrypt or decrypt a data key, not to generate new data keys. Do not add the generator keyring as a child keyring. This will result in generated data keys getting encrypted twice by that keyring, which is useless.</p>
<p>This operation is not threadsafe. If this is called at the same time as the multi-keyring is used for encrypt or decrypt, it results in undefined behavior.</p>
<p>It is not possible to remove a keyring from the multi-keyring at this time. </p>

</div>
</div>
<a id="gaa8483174b8c6a797b60606a34bc6cfe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa8483174b8c6a797b60606a34bc6cfe3">&#9670;&nbsp;</a></span>aws_cryptosdk_multi_keyring_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a>* aws_cryptosdk_multi_keyring_new </td>
          <td>(</td>
          <td class="paramtype">struct aws_allocator *&#160;</td>
          <td class="paramname"><em>alloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td>
          <td class="paramname"><em>generator</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new multi-keyring. This keyring allows you to combine keyrings into a single keyring. When used for encryption, the resulting document can be decrypted by any of the included keyrings. When used for decryption, the multi- keyring will attempt to decrypt using each of the included keyrings.</p>
<p>The second argument provided to the constructor is this multi-keyring's generator keyring, which is the first keyring it will call on encryption and decryption attempts, when it is set.</p>
<p>You may create a multi-keyring with no generator by setting the argument to NULL. If a generator is not set, the multi-keyring may be used for decryption or for encryption after another keyring has already generated a data key, (for example, as a child keyring of another multi-keyring.) However, a multi-keyring with no generator is not usable for encryption on its own.</p>
<p>Calling the multi-keyring's On Encrypt method does the following:</p>
<p>(1) Call the generator's On Encrypt method, if a generator has been set. If the generator's On Encrypt method fails, the multi-keyring's On Encrypt fails immediately, and the error code will be set by the generator keyring.</p>
<p>(2) Verify that an unencrypted data key has been generated, setting an error code of AWS_CRYPTOSDK_ERR_BAD_STATE and failing if it has not.</p>
<p>(3) Call the child keyrings' On Encrypt methods, producing a list of EDKs that are all encrypted versions of the data key verified in step (2). If any of the child keyring's On Encrypt methods fail, the multi-keyring's On Encrypt method will fail immediately, and the error code will be set by the failing child keyring.</p>
<p>(4) If all previous calls have succeeded, return the unencrypted data key and append all EDKs to the list provided by the caller.</p>
<p>The multi-keyring's On Decrypt call will attempt to decrypt an EDK with the generator (if one is set) and then each child keyring until it succeeds. Errors from any keyrings will not stop it from proceeding to the rest. If it succeeds in decrypting an EDK, it will return AWS_OP_SUCCESS, even if one or more of the keyrings failed. If it does not succeed in decrypting an EDK, it will return AWS_OP_SUCCESS if there were no errors, and AWS_OP_ERR if there were errors. As with all On Decrypt calls, check unencrypted_data_key.buffer to see whether an EDK was decrypted. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>

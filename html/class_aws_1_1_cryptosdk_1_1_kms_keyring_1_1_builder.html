<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AWS Encryption SDK for C: Aws::Cryptosdk::KmsKeyring::Builder Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AWS Encryption SDK for C
   &#160;<span id="projectnumber">v2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_aws.html">Aws</a></li><li class="navelem"><a class="el" href="namespace_aws_1_1_cryptosdk.html">Cryptosdk</a></li><li class="navelem"><a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a></li><li class="navelem"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">Aws::Cryptosdk::KmsKeyring::Builder Class Reference<div class="ingroups"><a class="el" href="group__kms__keyring.html">KMS keyring (AWS SDK for C++)</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="kms__keyring_8h_source.html">kms_keyring.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1dc2448617f6f385cd7e0da0d94fc8a0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html#a1dc2448617f6f385cd7e0da0d94fc8a0">WithGrantToken</a> (const Aws::String &amp;grant_token)</td></tr>
<tr class="separator:a1dc2448617f6f385cd7e0da0d94fc8a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ca06e9a8d5086264f2701f24b52a5d7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html#a8ca06e9a8d5086264f2701f24b52a5d7">WithGrantTokens</a> (const Aws::Vector&lt; Aws::String &gt; &amp;grant_tokens)</td></tr>
<tr class="separator:a8ca06e9a8d5086264f2701f24b52a5d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b375c98f2104e0a1ff9945f368a2595"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html#a3b375c98f2104e0a1ff9945f368a2595">WithClientSupplier</a> (const std::shared_ptr&lt; <a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_client_supplier.html">ClientSupplier</a> &gt; &amp;client_supplier)</td></tr>
<tr class="separator:a3b375c98f2104e0a1ff9945f368a2595"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66a925552d6ab6a6457b9c0edc76610b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html#a66a925552d6ab6a6457b9c0edc76610b">WithKmsClient</a> (const std::shared_ptr&lt; KMS::KMSClient &gt; &amp;kms_client)</td></tr>
<tr class="separator:a66a925552d6ab6a6457b9c0edc76610b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c99ae4f9dc24950302dea4072951655"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html#a0c99ae4f9dc24950302dea4072951655">Build</a> (const Aws::String &amp;generator_key_id, const Aws::Vector&lt; Aws::String &gt; &amp;additional_key_ids={}) const</td></tr>
<tr class="separator:a0c99ae4f9dc24950302dea4072951655"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbde10e55092ded7aa4da6737fd48b36"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html#abbde10e55092ded7aa4da6737fd48b36">BuildDiscovery</a> () const</td></tr>
<tr class="separator:abbde10e55092ded7aa4da6737fd48b36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dd7e9cb3a6b6037e8f20073fd47579b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html#a6dd7e9cb3a6b6037e8f20073fd47579b">BuildDiscovery</a> (std::shared_ptr&lt; <a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_discovery_filter.html">KmsKeyring::DiscoveryFilter</a> &gt; discovery_filter) const</td></tr>
<tr class="separator:a6dd7e9cb3a6b6037e8f20073fd47579b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Helper class for building a new <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> object. You cannot construct a <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> directly and must use this class instead. This class is the only API you need to interact with KmsKeyrings. You will set all of the configuration of the <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> with this class before calling Build, and once the keyring is built, its configuration cannot be changed.</p>
<p>After the <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> is constructed, the only ways you should interact with the (<a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a> *) are to pass it to a CMM or another keyring (such as the multi-keyring) and to release the pointer with aws_cryptosdk_keyring_release.</p>
<p>For general documentation about keyrings see <a class="el" href="materials_8h.html">include/aws/cryptosdk/materials.h</a>. This header will only document what is specific to the <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a>. </p>

<p class="definition">Definition at line <a class="el" href="kms__keyring_8h_source.html#l00064">64</a> of file <a class="el" href="kms__keyring_8h_source.html">kms_keyring.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a0c99ae4f9dc24950302dea4072951655"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c99ae4f9dc24950302dea4072951655">&#9670;&nbsp;</a></span>Build()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a>* Aws::Cryptosdk::KmsKeyring::Builder::Build </td>
          <td>(</td>
          <td class="paramtype">const Aws::String &amp;&#160;</td>
          <td class="paramname"><em>generator_key_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Aws::Vector&lt; Aws::String &gt; &amp;&#160;</td>
          <td class="paramname"><em>additional_key_ids</em> = <code>{}</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> object or returns NULL if parameters are invalid.</p>
<p>You must specify at least one KMS CMK to use as a master key for encryption and decryption as the generator CMK. This CMK is the first one that will be used in all encryption and decryption attempts, and it is the only key for which you need to have KMS GenerateDataKey permissions in order to do encryption.</p>
<p>If this keyring is called for encryption after another keyring has already generated the data key (for example, in a multi-keyring) then the generator CMK will encrypt an existing data key. In that case, you will need KMS Encrypt permissions on this CMK.</p>
<p>Optionally, you may specify a list of additional CMKs to encrypt the data key with. Encrypting with multiple CMKs gives users who have KMS Decrypt access with <em>any one</em> of those CMKs the ability to decrypt the data. For encryption you will only need KMS Encrypt permission on the additional CMKs. You will NEVER need KMS GenerateDataKey permission on them.</p>
<p>Providing multiple CMKs for decryption allows the decryption of data that was encrypted using any of those keys. You will need KMS Decrypt permission on the generator CMK and all other CMKs.</p>
<p>Key IDs for encryption may be specified in two different ways:</p>
<p>(1) key ARN: arn:aws:kms:us-east-1:999999999999:key/01234567-89ab-cdef-fedc-ba9876543210 (2) alias ARN: arn:aws:kms:us-east-1:999999999999:alias/MyCryptoKey</p>
<p>Key IDs for decryption must be specified as key ARNs only, i.e., format (1) above. Format (2) will not work for decryption. The AWS Encryption SDK will allow you to attempt decrypts with a <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> configured with keys in format (2) without errors, but it will only succeed in decrypting data that was encrypted with keys that were specified in key ARN format. This is a limitation of the message format of encryption and of the KMS APIs, not of this library. </p>

</div>
</div>
<a id="abbde10e55092ded7aa4da6737fd48b36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbde10e55092ded7aa4da6737fd48b36">&#9670;&nbsp;</a></span>BuildDiscovery() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a>* Aws::Cryptosdk::KmsKeyring::Builder::BuildDiscovery </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> object with no KMS keys configured, i.e., in "discovery" mode. This means the following:</p>
<p>(1) This <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> will not do anything on encryption attempts. If you attempt encryption with this as your only keyring, it will fail. If you include this keyring as part of a multi-keyring and attempt encryption, the results will be the same as if this keyring was not included.</p>
<p>(2) On attempts to decrypt, the AWS Encryption SDK will attempt KMS DecryptDataKey calls for every KMS key that was used to encrypt the data until it finds one that you have permission to use. This may include calls to any region and to KMS keys that are outside of your account, unless prevented by policies on the IAM user or role. </p>

</div>
</div>
<a id="a6dd7e9cb3a6b6037e8f20073fd47579b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dd7e9cb3a6b6037e8f20073fd47579b">&#9670;&nbsp;</a></span>BuildDiscovery() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structaws__cryptosdk__keyring.html">aws_cryptosdk_keyring</a>* Aws::Cryptosdk::KmsKeyring::Builder::BuildDiscovery </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_discovery_filter.html">KmsKeyring::DiscoveryFilter</a> &gt;&#160;</td>
          <td class="paramname"><em>discovery_filter</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> object in discovery mode (i.e., no KMS keys configured) but with a <a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_discovery_filter.html">DiscoveryFilter</a>. This means the following:</p>
<p>(1) As in discovery mode without a <a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_discovery_filter.html">DiscoveryFilter</a>, this <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> will not do anything on encryption attempts.</p>
<p>(2) On attempts to decrypt, the AWS Encryption SDK will attempt KMS DecryptDataKey calls for every KMS key that was used to encrypt the data until it finds one that:</p>
<p>(a) you have permission to use, and (b) that is in an account specified by the <a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_discovery_filter.html">DiscoveryFilter</a>.</p>
<p>This may include calls to any region, unless prevented by policies on the IAM user or role.</p>
<p>The discovery_filter argument must not be nullptr, or else this function fails and returns nullptr. </p>

</div>
</div>
<a id="a3b375c98f2104e0a1ff9945f368a2595"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b375c98f2104e0a1ff9945f368a2595">&#9670;&nbsp;</a></span>WithClientSupplier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a>&amp; Aws::Cryptosdk::KmsKeyring::Builder::WithClientSupplier </td>
          <td>(</td>
          <td class="paramtype">const std::shared_ptr&lt; <a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_client_supplier.html">ClientSupplier</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>client_supplier</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the object that supplies and caches KMSClient instances. This allows sharing of a client cache among multiple KMS keyrings. A client supplier which caches KMS clients only within this KMS keyring will be created by default if one is not provided. </p>

</div>
</div>
<a id="a1dc2448617f6f385cd7e0da0d94fc8a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dc2448617f6f385cd7e0da0d94fc8a0">&#9670;&nbsp;</a></span>WithGrantToken()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a>&amp; Aws::Cryptosdk::KmsKeyring::Builder::WithGrantToken </td>
          <td>(</td>
          <td class="paramtype">const Aws::String &amp;&#160;</td>
          <td class="paramname"><em>grant_token</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds a single grant token. For more information, see <a href="http://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#grant_token">http://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#grant_token</a></p>
<p>May be called multiple times, adding additional grant tokens to the list that the keyring is configured with. Once a grant token is added to the builder, it is not removable. To build a <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> with a different set of grant tokens, use a different builder. </p>

</div>
</div>
<a id="a8ca06e9a8d5086264f2701f24b52a5d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ca06e9a8d5086264f2701f24b52a5d7">&#9670;&nbsp;</a></span>WithGrantTokens()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a>&amp; Aws::Cryptosdk::KmsKeyring::Builder::WithGrantTokens </td>
          <td>(</td>
          <td class="paramtype">const Aws::Vector&lt; Aws::String &gt; &amp;&#160;</td>
          <td class="paramname"><em>grant_tokens</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds multiple grant tokens. For more information, see <a href="http://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#grant_token">http://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#grant_token</a></p>
<p>May be called multiple times, adding additional grant tokens to the list that the keyring is configured with. Once a grant token is added to the builder, it is not removable. To build a <a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> with a different set of grant tokens, use a different builder. </p>

</div>
</div>
<a id="a66a925552d6ab6a6457b9c0edc76610b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66a925552d6ab6a6457b9c0edc76610b">&#9670;&nbsp;</a></span>WithKmsClient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_aws_1_1_cryptosdk_1_1_kms_keyring_1_1_builder.html">Builder</a>&amp; Aws::Cryptosdk::KmsKeyring::Builder::WithKmsClient </td>
          <td>(</td>
          <td class="paramtype">const std::shared_ptr&lt; KMS::KMSClient &gt; &amp;&#160;</td>
          <td class="paramname"><em>kms_client</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="namespace_aws_1_1_cryptosdk_1_1_kms_keyring.html">KmsKeyring</a> will use only this KMS Client. Note that this is only suitable if all KMS keys are in one region. If this is set then the client supplier parameter is ignored. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="kms__keyring_8h_source.html">kms_keyring.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
